<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>clockd: mcc_tz_utils.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>mcc_tz_utils.c File Reference</h1>Time services - utils to work with country timezones. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="mcc__tz__utils_8h.html">mcc_tz_utils.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="logging_8h.html">logging.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="internal__time__utils_8h.html">internal_time_utils.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="clock__dbus_8h.html">clock_dbus.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="codec_8h.html">codec.h</a>&quot;</code><br>
<code>#include &lt;cityinfo.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;dbus/dbus-glib-lowlevel.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;ctype.h&gt;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#00977f0bdd7a7e0440de2fc235387a21">mcc_tz_is_tz_name_in_country_tz_list</a> (const char *tz_name)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#2dc3f4479eeb397975b1859362e1752d">mcc_tz_correct_tz_choice</a> (int found_tz_count, char **tz_name)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#95bc07a2eb5e1a54481dd37ccc325748">mcc_tz_find_tz_in_country_tz_list</a> (struct tm *utc_tm, int dst, int gmtoff, char **tz_name)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#d40878e8c5344c49e92a3f8db5264cb4">mcc_tz_guess_tz_for_country_by_dst_and_offset</a> (struct tm *utc_tm, int dst, int gmtoff, char **tz_name)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#94d2616bc3bd7ee3662482f24baa8e0d">mcc_tz_parse_mcc_mapping_line</a> (const char *line, char **country)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static gboolean&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#ba14c22e651536e2f7ed6cdfd638fa65">mcc_tz_find_country_by_mcc</a> (int mcc, char **found_country)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static gboolean&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#f8dfecd14a7213cc9df37d600b4f823e">mcc_tz_get_tz_if_only_for_country</a> (const char **found_tz)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static gint&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#c1d35476e939c1322a763df253e51421">tz_name_compare</a> (gconstpointer iterTZName, gconstpointer searchingTZName)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#c0e22b366763f973356a360e78a20179">mcc_tz_prepend_tz_name_if_not_dup</a> (const char *tz_name)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static gboolean&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#a9e45db568148a56b26f3405d33b5704">mcc_tz_searching_tz_by_country_name</a> (const Cityinfo *city, gpointer data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#633c8371e7ba82c01d1dab5bfe8449af">mcc_tz_create_tz_name_list_by_country_name</a> (const char *country_name)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#40404e89dbcb3b077fc2c7e3a61c2132">mcc_tz_destroy_country_tz_name_list</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#f4dafd7e3b1a2067512c1e2ea93702e5">mcc_tz_update_country_tz_name_list</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#25c37c109c18e0d11c2afe34c821af99">mcc_tz_set_tz_from_mcc</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#da93be443f7504849195681cfa9f3ac6">mcc_tz_handle_network_timeinfo_reply</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#35e47c190450cfa6c8d070491029db38">mcc_tz_network_timeinfo_reply_dbus_cb</a> (DBusPendingCall *pending_call, void *data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#7c4397a57922f8cb3971119d40393a29">mcc_tz_check_if_network_timeinfo_available</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#8eeafb2301ea1157a318f1c2e34fb2b1">mcc_tz_handle_registration_status_reply</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#fd0d6f84da879f48fa882521609bad81">mcc_tz_registration_status_reply_dbus_cb</a> (DBusPendingCall *pending_call, void *data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#c7da35a94a6743c02f44695757a327ec">mcc_tz_add_registration_change_match</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#39a6fde70015853a7bf213fe55a30e39">mcc_tz_remove_registration_change_match</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#b10a8e29cdff9783b65583e3286b2965">mcc_tz_setup_timezone_from_mcc_if_required</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#7f7742b4c04a1e05b7bd83be9277cc73">mcc_tz_utils_init</a> (DBusConnection *server_system_bus, GetAutosyncEnabled server_get_autosync_enabled, HandleCsdNetTimeChange server_handle_csd_net_time_change, SetOperatorTz server_set_operator_tz)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8c.html#ec643e632a49975f69f151628ebcfcf9">mcc_tz_utils_quit</a> (void)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Utilities to create list of timezones for a country determined by MCC (country code) and work with it<p>
Copyright (C) 2008 Nokia. All rights reserved.<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Simo Piiroinen &lt;<a href="mailto:simo.piiroinen@nokia.com">simo.piiroinen@nokia.com</a>&gt; <p>
Raimo Vuonnala &lt;<a href="mailto:raimo.vuonnala@nokia.com">raimo.vuonnala@nokia.com</a>&gt; </dd></dl>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="00977f0bdd7a7e0440de2fc235387a21"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_is_tz_name_in_country_tz_list" ref="00977f0bdd7a7e0440de2fc235387a21" args="(const char *tz_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mcc_tz_is_tz_name_in_country_tz_list           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>tz_name</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Checks if given timezone name is in timezone list for currnt country<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>tz_name</em>&nbsp;</td><td>timezone name for searching</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if given timezone name found in country_tz_name_list or 0 otherwise </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l00552">handle_csd_net_time_change()</a>.</p>

</div>
</div><p>
<a class="anchor" name="2dc3f4479eeb397975b1859362e1752d"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_correct_tz_choice" ref="2dc3f4479eeb397975b1859362e1752d" args="(int found_tz_count, char **tz_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mcc_tz_correct_tz_choice           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>found_tz_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>tz_name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Performs set of filters for found timezone (refer to mcc_tz_find_tz_in_country_tz_list and mcc_tz_guess_tz_for_country_by_dst_and_offset). See log strings in the function to understand what each filter is doing.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>found_tz_count</em>&nbsp;</td><td>count of similar timezones returned by mcc_tz_find_tz_in_country_tz_list </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tz_name</em>&nbsp;</td><td>Not changed if filters allow timezone, NULL otherwise </td></tr>
  </table>
</dl>

<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00199">mcc_tz_guess_tz_for_country_by_dst_and_offset()</a>.</p>

</div>
</div><p>
<a class="anchor" name="95bc07a2eb5e1a54481dd37ccc325748"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_find_tz_in_country_tz_list" ref="95bc07a2eb5e1a54481dd37ccc325748" args="(struct tm *utc_tm, int dst, int gmtoff, char **tz_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int mcc_tz_find_tz_in_country_tz_list           </td>
          <td>(</td>
          <td class="paramtype">struct tm *&nbsp;</td>
          <td class="paramname"> <em>utc_tm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>gmtoff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>tz_name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Searches for tz in country tz list generated by current mcc which has the same DST and GMT offset as requested in given UTC time. Returns first found timezone name (in tz_name) and number of found timezones.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>utc_tm</em>&nbsp;</td><td>UTC time to search in </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dst</em>&nbsp;</td><td>DST for searching timezone in given UTC time </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>gmtoff</em>&nbsp;</td><td>GMT offset for searching timezone in given UTC time </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tz_name</em>&nbsp;</td><td>name of first found timezone for requested parameters or NULL if not found It shall not be freed since it is pointer to string contained in country_tz_name_list Also the user must dup this string if it is needed in next mainloop cycle since the list might be updated in-between.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>number of found timezones </dd></dl>

<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00199">mcc_tz_guess_tz_for_country_by_dst_and_offset()</a>.</p>

</div>
</div><p>
<a class="anchor" name="d40878e8c5344c49e92a3f8db5264cb4"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_guess_tz_for_country_by_dst_and_offset" ref="d40878e8c5344c49e92a3f8db5264cb4" args="(struct tm *utc_tm, int dst, int gmtoff, char **tz_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mcc_tz_guess_tz_for_country_by_dst_and_offset           </td>
          <td>(</td>
          <td class="paramtype">struct tm *&nbsp;</td>
          <td class="paramname"> <em>utc_tm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>gmtoff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>tz_name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Guesses named timezone for current country which has the same DST and GMT offset as requested in given UTC time. Returns first found name in tz_name or NULL if not found.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>utc_tm</em>&nbsp;</td><td>UTC time to search in </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dst</em>&nbsp;</td><td>DST for searching timezone in given UTC time </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>gmtoff</em>&nbsp;</td><td>GMT offset for searching timezone in given UTC time </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tz_name</em>&nbsp;</td><td>name of found timezone for requested parameters or NULL if not found It shall not be freed since it is pointer to string contained in country_tz_name_list Also the user must dup this string if it is needed in next mainloop cycle since the list might be updated in-between. </td></tr>
  </table>
</dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l00552">handle_csd_net_time_change()</a>.</p>

</div>
</div><p>
<a class="anchor" name="94d2616bc3bd7ee3662482f24baa8e0d"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_parse_mcc_mapping_line" ref="94d2616bc3bd7ee3662482f24baa8e0d" args="(const char *line, char **country)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int mcc_tz_parse_mcc_mapping_line           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>country</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Parse line from /usr/share/operator-wizard/mcc_mapping to extract MCC and country name.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>line</em>&nbsp;</td><td>line from /usr/share/operator-wizard/mcc_mapping to parse </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>country</em>&nbsp;</td><td>NULL if fails, country name (localizable) if OK</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 if fails, MCC (country code) if OK </dd></dl>

<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00263">mcc_tz_find_country_by_mcc()</a>.</p>

</div>
</div><p>
<a class="anchor" name="ba14c22e651536e2f7ed6cdfd638fa65"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_find_country_by_mcc" ref="ba14c22e651536e2f7ed6cdfd638fa65" args="(int mcc, char **found_country)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static gboolean mcc_tz_find_country_by_mcc           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mcc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>found_country</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Map MCC to country name using /usr/share/operator-wizard/mcc_mapping Allocates memory to return country name. Caller is responsible to free the memory.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mcc</em>&nbsp;</td><td>MCC to find </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>found_country</em>&nbsp;</td><td>NULL if fails, country name (localizable) if OK</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE if not found, TRUE otherwise </dd></dl>

<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00447">mcc_tz_update_country_tz_name_list()</a>.</p>

</div>
</div><p>
<a class="anchor" name="f8dfecd14a7213cc9df37d600b4f823e"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_get_tz_if_only_for_country" ref="f8dfecd14a7213cc9df37d600b4f823e" args="(const char **found_tz)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static gboolean mcc_tz_get_tz_if_only_for_country           </td>
          <td>(</td>
          <td class="paramtype">const char **&nbsp;</td>
          <td class="paramname"> <em>found_tz</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Wrapper above country_tz_name_list to check if only TZ was found for country. If only timezone found, memory is NOT allocated to returm its name. This memory must NOT be freed by caller.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>found_tz</em>&nbsp;</td><td>NULL if not found or multiple timezones found, timezone name otherwise</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE if not found or multiple timezones found, TRUE otherwise </dd></dl>

<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00467">mcc_tz_set_tz_from_mcc()</a>.</p>

</div>
</div><p>
<a class="anchor" name="c1d35476e939c1322a763df253e51421"></a><!-- doxytag: member="mcc_tz_utils.c::tz_name_compare" ref="c1d35476e939c1322a763df253e51421" args="(gconstpointer iterTZName, gconstpointer searchingTZName)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static gint tz_name_compare           </td>
          <td>(</td>
          <td class="paramtype">gconstpointer&nbsp;</td>
          <td class="paramname"> <em>iterTZName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gconstpointer&nbsp;</td>
          <td class="paramname"> <em>searchingTZName</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Custom compare function used to find time zone name in country_tz_name_list<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>iterTZName</em>&nbsp;</td><td>TZ Name in iterator </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>searchingTZName</em>&nbsp;</td><td>TZ Name to find</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 if TZ are equal, not 0 otherwise </dd></dl>

<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00350">mcc_tz_prepend_tz_name_if_not_dup()</a>.</p>

</div>
</div><p>
<a class="anchor" name="c0e22b366763f973356a360e78a20179"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_prepend_tz_name_if_not_dup" ref="c0e22b366763f973356a360e78a20179" args="(const char *tz_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mcc_tz_prepend_tz_name_if_not_dup           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>tz_name</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Prepend tz_name to list of tz names for country if not a dup. The list is stored in country_tz_name_list<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>tz_name</em>&nbsp;</td><td>TZ name to prepend to country_tz_name_list if not a dup </td></tr>
  </table>
</dl>

<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00369">mcc_tz_searching_tz_by_country_name()</a>.</p>

</div>
</div><p>
<a class="anchor" name="a9e45db568148a56b26f3405d33b5704"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_searching_tz_by_country_name" ref="a9e45db568148a56b26f3405d33b5704" args="(const Cityinfo *city, gpointer data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static gboolean mcc_tz_searching_tz_by_country_name           </td>
          <td>(</td>
          <td class="paramtype">const Cityinfo *&nbsp;</td>
          <td class="paramname"> <em>city</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gpointer&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Helper function used to fill timezone name list for the named country. Refer to cityinfo API for details about helper functions for cityinfo_foreach algorithm<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>city</em>&nbsp;</td><td>Entry in city info db </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>Country name for searching</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE to stop searching, TRUE otherwise </dd></dl>

<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00417">mcc_tz_create_tz_name_list_by_country_name()</a>.</p>

</div>
</div><p>
<a class="anchor" name="633c8371e7ba82c01d1dab5bfe8449af"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_create_tz_name_list_by_country_name" ref="633c8371e7ba82c01d1dab5bfe8449af" args="(const char *country_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mcc_tz_create_tz_name_list_by_country_name           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>country_name</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create list of tz names for country. The list is stored in country_tz_name_list 
<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00447">mcc_tz_update_country_tz_name_list()</a>.</p>

</div>
</div><p>
<a class="anchor" name="40404e89dbcb3b077fc2c7e3a61c2132"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_destroy_country_tz_name_list" ref="40404e89dbcb3b077fc2c7e3a61c2132" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mcc_tz_destroy_country_tz_name_list           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Destroys list of tz names for contry. 
<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00447">mcc_tz_update_country_tz_name_list()</a>, and <a class="el" href="mcc__tz__utils_8c-source.html#l00787">mcc_tz_utils_quit()</a>.</p>

</div>
</div><p>
<a class="anchor" name="f4dafd7e3b1a2067512c1e2ea93702e5"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_update_country_tz_name_list" ref="f4dafd7e3b1a2067512c1e2ea93702e5" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mcc_tz_update_country_tz_name_list           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Updates list of tz names for country determined by MCC (mcc_cache). The list is stored in country_tz_name_list 
<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00579">mcc_tz_handle_registration_status_reply()</a>.</p>

</div>
</div><p>
<a class="anchor" name="25c37c109c18e0d11c2afe34c821af99"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_set_tz_from_mcc" ref="25c37c109c18e0d11c2afe34c821af99" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mcc_tz_set_tz_from_mcc           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Change current timezone to found by MCC if MCC can be definitely mapped to timezone It used cached value of MCC (mcc_cache). 
<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00490">mcc_tz_handle_network_timeinfo_reply()</a>.</p>

</div>
</div><p>
<a class="anchor" name="da93be443f7504849195681cfa9f3ac6"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_handle_network_timeinfo_reply" ref="da93be443f7504849195681cfa9f3ac6" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mcc_tz_handle_network_timeinfo_reply           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle reply on get time info request to CSD. If autoupdate is off - do nothing. If autoupdate is on and NITZ supported by network, it parse reply and set network time. If autoupdate is on and NITZ does not supported by network, it makes attempt to correct timezone at least using cached MCC<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>D-Bus reply on get time info request to CSD </td></tr>
  </table>
</dl>

<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00506">mcc_tz_network_timeinfo_reply_dbus_cb()</a>.</p>

</div>
</div><p>
<a class="anchor" name="35e47c190450cfa6c8d070491029db38"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_network_timeinfo_reply_dbus_cb" ref="35e47c190450cfa6c8d070491029db38" args="(DBusPendingCall *pending_call, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mcc_tz_network_timeinfo_reply_dbus_cb           </td>
          <td>(</td>
          <td class="paramtype">DBusPendingCall *&nbsp;</td>
          <td class="paramname"> <em>pending_call</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Callback to catch reply on get time info request to CSD. Refer to D-Bus API for details<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pending_call</em>&nbsp;</td><td>D-Bus object to catch reply </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>Not used </td></tr>
  </table>
</dl>

<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00545">mcc_tz_check_if_network_timeinfo_available()</a>.</p>

</div>
</div><p>
<a class="anchor" name="7c4397a57922f8cb3971119d40393a29"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_check_if_network_timeinfo_available" ref="7c4397a57922f8cb3971119d40393a29" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mcc_tz_check_if_network_timeinfo_available           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Sends get time info request to CSD. Reply is catched by mcc_tz_network_timeinfo_reply_dbus_cb callback 
<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00579">mcc_tz_handle_registration_status_reply()</a>.</p>

</div>
</div><p>
<a class="anchor" name="8eeafb2301ea1157a318f1c2e34fb2b1"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_handle_registration_status_reply" ref="8eeafb2301ea1157a318f1c2e34fb2b1" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mcc_tz_handle_registration_status_reply           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle reply on get registration status request to CSD. If registered in home or roaming network and received MCC is not equal to cached one, launch network time update attempt, since country (and timezone probably) is changed.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>D-Bus reply on get registration status request to CSD </td></tr>
  </table>
</dl>

<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00629">mcc_tz_registration_status_reply_dbus_cb()</a>, and <a class="el" href="server_8c-source.html#l01085">server_filter()</a>.</p>

</div>
</div><p>
<a class="anchor" name="fd0d6f84da879f48fa882521609bad81"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_registration_status_reply_dbus_cb" ref="fd0d6f84da879f48fa882521609bad81" args="(DBusPendingCall *pending_call, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mcc_tz_registration_status_reply_dbus_cb           </td>
          <td>(</td>
          <td class="paramtype">DBusPendingCall *&nbsp;</td>
          <td class="paramname"> <em>pending_call</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Callback to catch reply on get registration status request to CSD. Refer to D-Bus API for details<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pending_call</em>&nbsp;</td><td>D-Bus object to catch reply </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>Not used </td></tr>
  </table>
</dl>

<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00723">mcc_tz_setup_timezone_from_mcc_if_required()</a>.</p>

</div>
</div><p>
<a class="anchor" name="c7da35a94a6743c02f44695757a327ec"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_add_registration_change_match" ref="c7da35a94a6743c02f44695757a327ec" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mcc_tz_add_registration_change_match           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Add tracking of registration status change signal to system bus if it was not added before 
<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00723">mcc_tz_setup_timezone_from_mcc_if_required()</a>.</p>

</div>
</div><p>
<a class="anchor" name="39a6fde70015853a7bf213fe55a30e39"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_remove_registration_change_match" ref="39a6fde70015853a7bf213fe55a30e39" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mcc_tz_remove_registration_change_match           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Remove tracking of registration status change signal from system bus if it was added before 
<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00723">mcc_tz_setup_timezone_from_mcc_if_required()</a>, and <a class="el" href="mcc__tz__utils_8c-source.html#l00787">mcc_tz_utils_quit()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b10a8e29cdff9783b65583e3286b2965"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_setup_timezone_from_mcc_if_required" ref="b10a8e29cdff9783b65583e3286b2965" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mcc_tz_setup_timezone_from_mcc_if_required           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
If autoupdate is on, it sends get registration status request to CSD. It launches procedure to update time if device is registered in network. Reply is catched by mcc_tz_registration_status_reply_dbus_cb callback.<p>
Also the method asks D-Bus to notify about registration status change signal if time autoupdate is on and remove this tracking if time autoupdate is off. The signal is handled by server_filter (refer to mcc_tz_init also). 
<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00765">mcc_tz_utils_init()</a>, and <a class="el" href="server_8c-source.html#l01012">server_set_autosync_cb()</a>.</p>

</div>
</div><p>
<a class="anchor" name="7f7742b4c04a1e05b7bd83be9277cc73"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_utils_init" ref="7f7742b4c04a1e05b7bd83be9277cc73" args="(DBusConnection *server_system_bus, GetAutosyncEnabled server_get_autosync_enabled, HandleCsdNetTimeChange server_handle_csd_net_time_change, SetOperatorTz server_set_operator_tz)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mcc_tz_utils_init           </td>
          <td>(</td>
          <td class="paramtype">DBusConnection *&nbsp;</td>
          <td class="paramname"> <em>server_system_bus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GetAutosyncEnabled&nbsp;</td>
          <td class="paramname"> <em>server_get_autosync_enabled</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HandleCsdNetTimeChange&nbsp;</td>
          <td class="paramname"> <em>server_handle_csd_net_time_change</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SetOperatorTz&nbsp;</td>
          <td class="paramname"> <em>server_set_operator_tz</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Fuction to init mcc_tz module<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>server_system_bus</em>&nbsp;</td><td>pointer to system DBUS </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>server_get_autosync_enabled</em>&nbsp;</td><td>pointer to function to get autosync_enabled value </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>server_handle_csd_net_time_change</em>&nbsp;</td><td>pointer to function to handle time info message from csd </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>server_set_operator_tz</em>&nbsp;</td><td>pointer to function to set operator timezone</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>-1 if error, 0 otherwise </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01245">server_init()</a>.</p>

</div>
</div><p>
<a class="anchor" name="ec643e632a49975f69f151628ebcfcf9"></a><!-- doxytag: member="mcc_tz_utils.c::mcc_tz_utils_quit" ref="ec643e632a49975f69f151628ebcfcf9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mcc_tz_utils_quit           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Fuction to free resources allocated by mcc_tz module 
<p>Referenced by <a class="el" href="server_8c-source.html#l01430">server_quit()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jun 21 15:45:53 2010 for clockd by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
