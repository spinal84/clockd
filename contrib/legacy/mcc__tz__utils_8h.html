<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>clockd: mcc_tz_utils.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>mcc_tz_utils.h File Reference</h1>Time services - utils to work with country timezones. <a href="#_details">More...</a>
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8h.html#00977f0bdd7a7e0440de2fc235387a21">mcc_tz_is_tz_name_in_country_tz_list</a> (const char *tz_name)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8h.html#d40878e8c5344c49e92a3f8db5264cb4">mcc_tz_guess_tz_for_country_by_dst_and_offset</a> (struct tm *utc_tm, int dst, int gmtoff, char **tz_name)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8h.html#b10a8e29cdff9783b65583e3286b2965">mcc_tz_setup_timezone_from_mcc_if_required</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8h.html#3b9580da7fbc8ad040a32f96558f2b8d">mcc_tz_handle_registration_status_reply</a> (struct DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8h.html#d8f43f4e85d31bab0e77d651473f4fb0">mcc_tz_utils_init</a> (struct DBusConnection *server_system_bus, GetAutosyncEnabled server_get_autosync_enabled, HandleCsdNetTimeChange server_handle_csd_net_time_change, SetOperatorTz server_set_operator_tz)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcc__tz__utils_8h.html#ec643e632a49975f69f151628ebcfcf9">mcc_tz_utils_quit</a> (void)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Copyright (C) 2008 Nokia. All rights reserved.<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Simo Piiroinen &lt;<a href="mailto:simo.piiroinen@nokia.com">simo.piiroinen@nokia.com</a>&gt; <p>
Raimo Vuonnala &lt;<a href="mailto:raimo.vuonnala@nokia.com">raimo.vuonnala@nokia.com</a>&gt; </dd></dl>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="00977f0bdd7a7e0440de2fc235387a21"></a><!-- doxytag: member="mcc_tz_utils.h::mcc_tz_is_tz_name_in_country_tz_list" ref="00977f0bdd7a7e0440de2fc235387a21" args="(const char *tz_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mcc_tz_is_tz_name_in_country_tz_list           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>tz_name</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Checks if given timezone name is in timezone list for currnt country<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>tz_name</em>&nbsp;</td><td>timezone name for searching</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if given timezone name found in country_tz_name_list or 0 otherwise </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l00552">handle_csd_net_time_change()</a>.</p>

</div>
</div><p>
<a class="anchor" name="d40878e8c5344c49e92a3f8db5264cb4"></a><!-- doxytag: member="mcc_tz_utils.h::mcc_tz_guess_tz_for_country_by_dst_and_offset" ref="d40878e8c5344c49e92a3f8db5264cb4" args="(struct tm *utc_tm, int dst, int gmtoff, char **tz_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mcc_tz_guess_tz_for_country_by_dst_and_offset           </td>
          <td>(</td>
          <td class="paramtype">struct tm *&nbsp;</td>
          <td class="paramname"> <em>utc_tm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>gmtoff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>tz_name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Guesses named timezone for current country which has the same DST and GMT offset as requested in given UTC time. Returns first found name in tz_name or NULL if not found.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>utc_tm</em>&nbsp;</td><td>UTC time to search in </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dst</em>&nbsp;</td><td>DST for searching timezone in given UTC time </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>gmtoff</em>&nbsp;</td><td>GMT offset for searching timezone in given UTC time </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tz_name</em>&nbsp;</td><td>name of found timezone for requested parameters or NULL if not found It shall not be freed since it is pointer to string contained in country_tz_name_list Also the user must dup this string if it is needed in next mainloop cycle since the list might be updated in-between. </td></tr>
  </table>
</dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l00552">handle_csd_net_time_change()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b10a8e29cdff9783b65583e3286b2965"></a><!-- doxytag: member="mcc_tz_utils.h::mcc_tz_setup_timezone_from_mcc_if_required" ref="b10a8e29cdff9783b65583e3286b2965" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mcc_tz_setup_timezone_from_mcc_if_required           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
If autoupdate is on, it sends get registration status request to CSD. It launches procedure to update time if device is registered in network.<p>
Also the method asks D-Bus to notify about registration status change signal if time autoupdate is on and remove this tracking if time autoupdate is off. The signal is handled by server_filter (refer to mcc_tz_init also).<p>
If autoupdate is on, it sends get registration status request to CSD. It launches procedure to update time if device is registered in network. Reply is catched by mcc_tz_registration_status_reply_dbus_cb callback.<p>
Also the method asks D-Bus to notify about registration status change signal if time autoupdate is on and remove this tracking if time autoupdate is off. The signal is handled by server_filter (refer to mcc_tz_init also). 
<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00765">mcc_tz_utils_init()</a>, and <a class="el" href="server_8c-source.html#l01012">server_set_autosync_cb()</a>.</p>

</div>
</div><p>
<a class="anchor" name="3b9580da7fbc8ad040a32f96558f2b8d"></a><!-- doxytag: member="mcc_tz_utils.h::mcc_tz_handle_registration_status_reply" ref="3b9580da7fbc8ad040a32f96558f2b8d" args="(struct DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mcc_tz_handle_registration_status_reply           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle reply on get registration status request to CSD. If registered in home or roaming network and received MCC is not equal to cached one, launch network time update attempt, since country (and timezone probably) is changed.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>D-Bus reply on get registration status request to CSD </td></tr>
  </table>
</dl>

<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00629">mcc_tz_registration_status_reply_dbus_cb()</a>, and <a class="el" href="server_8c-source.html#l01085">server_filter()</a>.</p>

</div>
</div><p>
<a class="anchor" name="d8f43f4e85d31bab0e77d651473f4fb0"></a><!-- doxytag: member="mcc_tz_utils.h::mcc_tz_utils_init" ref="d8f43f4e85d31bab0e77d651473f4fb0" args="(struct DBusConnection *server_system_bus, GetAutosyncEnabled server_get_autosync_enabled, HandleCsdNetTimeChange server_handle_csd_net_time_change, SetOperatorTz server_set_operator_tz)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mcc_tz_utils_init           </td>
          <td>(</td>
          <td class="paramtype">DBusConnection *&nbsp;</td>
          <td class="paramname"> <em>server_system_bus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GetAutosyncEnabled&nbsp;</td>
          <td class="paramname"> <em>server_get_autosync_enabled</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HandleCsdNetTimeChange&nbsp;</td>
          <td class="paramname"> <em>server_handle_csd_net_time_change</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SetOperatorTz&nbsp;</td>
          <td class="paramname"> <em>server_set_operator_tz</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Fuction to init mcc_tz module<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>server_system_bus</em>&nbsp;</td><td>pointer to system DBUS </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>server_get_autosync_enabled</em>&nbsp;</td><td>pointer to function to get autosync_enabled value </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>server_handle_csd_net_time_change</em>&nbsp;</td><td>pointer to function to handle time info message from csd </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>server_set_operator_tz</em>&nbsp;</td><td>pointer to function to set operator timezone</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>-1 if error, 0 otherwise </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01245">server_init()</a>.</p>

</div>
</div><p>
<a class="anchor" name="ec643e632a49975f69f151628ebcfcf9"></a><!-- doxytag: member="mcc_tz_utils.h::mcc_tz_utils_quit" ref="ec643e632a49975f69f151628ebcfcf9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mcc_tz_utils_quit           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Fuction to free resources allocated by mcc_tz module 
<p>Referenced by <a class="el" href="server_8c-source.html#l01430">server_quit()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jun 21 15:45:53 2010 for clockd by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
