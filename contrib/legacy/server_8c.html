<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>clockd: server.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>server.c File Reference</h1>clockd 'server' <a href="#_details">More...</a>
<p>
<code>#include &lt;sys/types.h&gt;</code><br>
<code>#include &lt;sys/socket.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;limits.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;errno.h&gt;</code><br>
<code>#include &lt;sys/stat.h&gt;</code><br>
<code>#include &lt;fcntl.h&gt;</code><br>
<code>#include &lt;sys/ioctl.h&gt;</code><br>
<code>#include &lt;sys/times.h&gt;</code><br>
<code>#include &lt;signal.h&gt;</code><br>
<code>#include &lt;libosso.h&gt;</code><br>
<code>#include &quot;<a class="el" href="codec_8h.html">codec.h</a>&quot;</code><br>
<code>#include &lt;dbus/dbus-glib-lowlevel.h&gt;</code><br>
<code>#include &lt;assert.h&gt;</code><br>
<code>#include &quot;<a class="el" href="logging_8h.html">logging.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="server_8h.html">server.h</a>&quot;</code><br>
<code>#include &quot;libtime.h&quot;</code><br>
<code>#include &quot;<a class="el" href="clock__dbus_8h.html">clock_dbus.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="internal__time__utils_8h.html">internal_time_utils.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="mcc__tz__utils_8h.html">mcc_tz_utils.h</a>&quot;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static gboolean&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#a820f6d6505f439d49ccb677f0685aca">handle_alarm</a> (DBusConnection *bus)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#25016d2e87b3d7edb7591716cf9837c8">read_conf</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#5c4f249b0016dfdebed91cda08a4e112">save_conf</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#83ddaa41ef0c1e97112860758dd79088">server_send_time_change_indication</a> (time_t t)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#e0bbda86dedbf6c5b689b687668dfb64">server_set_time</a> (time_t t)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static DBusMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#c1135c9baaefdad241b27f2c661fbb55">server_new_rsp</a> (DBusMessage *msg, int type,...)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static DBusMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#a7dcb3eaec78431c2b0ad805820bebb8">server_set_time_cb</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static DBusMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#9b48595b3ce25c37036514e16dfcd856">server_activate_net_time_cb</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#f923fe6ea7a6f55feb66dbe12152b88b">handle_csd_net_time_change</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static DBusMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#39861d902a513a5fc0563f444aa0e0d9">server_get_time_format_cb</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static DBusMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#4f34baf5f1aefdd52a09aff9c83f847a">server_get_default_tz_cb</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static DBusMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#874660ec10cc6a8a1538322a40989645">server_get_time_cb</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static DBusMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#605aa788ce9115f424bfb04175e52925">server_set_time_format_cb</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static DBusMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#774c29b48c1e29014bc8aa6fa01acf24">server_get_tz_cb</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static DBusMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#8d652764c0adee7678716e6882078d7b">server_is_net_time_changed_cb</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static DBusMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#a9db2e987c18b79e684ad76ce102ef5e">server_set_tz_cb</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static DBusMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#21e22d59119b41c929c3fa6afcbb3964">server_get_autosync_cb</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static DBusMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#d73595144a50902e37259d4e5d11d31e">server_set_autosync_cb</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static DBusMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#b759dff3835294c16d298e030b2337b8">server_have_opertime_cb</a> (DBusMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static DBusHandlerResult&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#7b22ccde141142daa56d1512eb2882cb">server_filter</a> (DBusConnection *conn, DBusMessage *msg, void *user_data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#5bb06385380180590dbab357a0c5872d">server_init</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#e41a4eef04590dbaad21aa4f8eee8169">server_quit</a> (void)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This is D-Bus server for clockd that communicates with clock/time -aware applications. It also listens for CSD NET_TIME_CHANGE signal and reacts to it accordingly.<p>
Copyright (C) 2008 Nokia. All rights reserved.<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Simo Piiroinen &lt;<a href="mailto:simo.piiroinen@nokia.com">simo.piiroinen@nokia.com</a>&gt; <p>
Raimo Vuonnala &lt;<a href="mailto:raimo.vuonnala@nokia.com">raimo.vuonnala@nokia.com</a>&gt; </dd></dl>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a820f6d6505f439d49ccb677f0685aca"></a><!-- doxytag: member="server.c::handle_alarm" ref="a820f6d6505f439d49ccb677f0685aca" args="(DBusConnection *bus)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static gboolean handle_alarm           </td>
          <td>(</td>
          <td class="paramtype">DBusConnection *&nbsp;</td>
          <td class="paramname"> <em>bus</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Check DST change and send time change indication when DST changes. 
</div>
</div><p>
<a class="anchor" name="25016d2e87b3d7edb7591716cf9837c8"></a><!-- doxytag: member="server.c::read_conf" ref="25016d2e87b3d7edb7591716cf9837c8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int read_conf           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read /home/user/.clockd.conf contents<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 if OK, -1 if error </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01245">server_init()</a>.</p>

</div>
</div><p>
<a class="anchor" name="5c4f249b0016dfdebed91cda08a4e112"></a><!-- doxytag: member="server.c::save_conf" ref="5c4f249b0016dfdebed91cda08a4e112" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int save_conf           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Save current config to /home/user/.clockd.conf<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 if OK, -1 if error </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l00552">handle_csd_net_time_change()</a>, <a class="el" href="server_8c-source.html#l01245">server_init()</a>, <a class="el" href="server_8c-source.html#l01012">server_set_autosync_cb()</a>, <a class="el" href="server_8c-source.html#l00418">server_set_time_cb()</a>, <a class="el" href="server_8c-source.html#l00817">server_set_time_format_cb()</a>, and <a class="el" href="server_8c-source.html#l00929">server_set_tz_cb()</a>.</p>

</div>
</div><p>
<a class="anchor" name="83ddaa41ef0c1e97112860758dd79088"></a><!-- doxytag: member="server.c::server_send_time_change_indication" ref="83ddaa41ef0c1e97112860758dd79088" args="(time_t t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int server_send_time_change_indication           </td>
          <td>(</td>
          <td class="paramtype">time_t&nbsp;</td>
          <td class="paramname"> <em>t</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send "change" indication to all interested parties (via libosso).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>t</em>&nbsp;</td><td>Current time</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 if OK, -1 if error </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l00351">handle_alarm()</a>, <a class="el" href="server_8c-source.html#l00552">handle_csd_net_time_change()</a>, <a class="el" href="server_8c-source.html#l01012">server_set_autosync_cb()</a>, <a class="el" href="server_8c-source.html#l00418">server_set_time_cb()</a>, <a class="el" href="server_8c-source.html#l00817">server_set_time_format_cb()</a>, and <a class="el" href="server_8c-source.html#l00929">server_set_tz_cb()</a>.</p>

</div>
</div><p>
<a class="anchor" name="e0bbda86dedbf6c5b689b687668dfb64"></a><!-- doxytag: member="server.c::server_set_time" ref="e0bbda86dedbf6c5b689b687668dfb64" args="(time_t t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int server_set_time           </td>
          <td>(</td>
          <td class="paramtype">time_t&nbsp;</td>
          <td class="paramname"> <em>t</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set system and RTC time using suidroot rclockd helper<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>t</em>&nbsp;</td><td>Current time</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 if OK, -1 if error </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l00552">handle_csd_net_time_change()</a>, and <a class="el" href="server_8c-source.html#l00418">server_set_time_cb()</a>.</p>

</div>
</div><p>
<a class="anchor" name="c1135c9baaefdad241b27f2c661fbb55"></a><!-- doxytag: member="server.c::server_new_rsp" ref="c1135c9baaefdad241b27f2c661fbb55" args="(DBusMessage *msg, int type,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DBusMessage* server_new_rsp           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create D-Bus method call response message<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>request message </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>vararg type/value attributes</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL if fails, pointer to DBusMessage if OK </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l00529">server_activate_net_time_cb()</a>, <a class="el" href="server_8c-source.html#l00997">server_get_autosync_cb()</a>, <a class="el" href="server_8c-source.html#l00781">server_get_default_tz_cb()</a>, <a class="el" href="server_8c-source.html#l00798">server_get_time_cb()</a>, <a class="el" href="server_8c-source.html#l00766">server_get_time_format_cb()</a>, <a class="el" href="server_8c-source.html#l00863">server_get_tz_cb()</a>, <a class="el" href="server_8c-source.html#l01068">server_have_opertime_cb()</a>, <a class="el" href="server_8c-source.html#l00877">server_is_net_time_changed_cb()</a>, <a class="el" href="server_8c-source.html#l01012">server_set_autosync_cb()</a>, <a class="el" href="server_8c-source.html#l00418">server_set_time_cb()</a>, <a class="el" href="server_8c-source.html#l00817">server_set_time_format_cb()</a>, and <a class="el" href="server_8c-source.html#l00929">server_set_tz_cb()</a>.</p>

</div>
</div><p>
<a class="anchor" name="a7dcb3eaec78431c2b0ad805820bebb8"></a><!-- doxytag: member="server.c::server_set_time_cb" ref="a7dcb3eaec78431c2b0ad805820bebb8" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DBusMessage* server_set_time_cb           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle D-Bus set_time method. Sets system/RTC time and sends time change indication with libosso.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>request message</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL if fails, pointer to response DBusMessage if OK </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01085">server_filter()</a>.</p>

</div>
</div><p>
<a class="anchor" name="9b48595b3ce25c37036514e16dfcd856"></a><!-- doxytag: member="server.c::server_activate_net_time_cb" ref="9b48595b3ce25c37036514e16dfcd856" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DBusMessage* server_activate_net_time_cb           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle D-Bus activate_net_time method. Sets system/RTC time and sends time change indication with libosso.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>request message</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL if fails, pointer to response DBusMessage if OK </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01085">server_filter()</a>.</p>

</div>
</div><p>
<a class="anchor" name="f923fe6ea7a6f55feb66dbe12152b88b"></a><!-- doxytag: member="server.c::handle_csd_net_time_change" ref="f923fe6ea7a6f55feb66dbe12152b88b" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int handle_csd_net_time_change           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle D-Bus net_time_change signal from CSD. If network autosync is enabled, set system/RTC time and sends time change indication with libosso; otherwise just store the data (that can be activated with activate_net_time method later)<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>signal message </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>-1 if failed to update time (e.g. NITZ does not supported by carrier), otherwise 0 </dd></dl>

<p>Referenced by <a class="el" href="mcc__tz__utils_8c-source.html#l00490">mcc_tz_handle_network_timeinfo_reply()</a>, <a class="el" href="mcc__tz__utils_8c-source.html#l00765">mcc_tz_utils_init()</a>, <a class="el" href="mcc__tz__utils_8c-source.html#l00787">mcc_tz_utils_quit()</a>, <a class="el" href="server_8c-source.html#l01085">server_filter()</a>, and <a class="el" href="server_8c-source.html#l01245">server_init()</a>.</p>

</div>
</div><p>
<a class="anchor" name="39861d902a513a5fc0563f444aa0e0d9"></a><!-- doxytag: member="server.c::server_get_time_format_cb" ref="39861d902a513a5fc0563f444aa0e0d9" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DBusMessage* server_get_time_format_cb           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle D-Bus get_time_fmt method<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>request message</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL if fails, pointer to response DBusMessage if OK </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01085">server_filter()</a>.</p>

</div>
</div><p>
<a class="anchor" name="4f34baf5f1aefdd52a09aff9c83f847a"></a><!-- doxytag: member="server.c::server_get_default_tz_cb" ref="4f34baf5f1aefdd52a09aff9c83f847a" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DBusMessage* server_get_default_tz_cb           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle D-Bus get_default_tz method<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>request message</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL if fails, pointer to response DBusMessage if OK </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01085">server_filter()</a>.</p>

</div>
</div><p>
<a class="anchor" name="874660ec10cc6a8a1538322a40989645"></a><!-- doxytag: member="server.c::server_get_time_cb" ref="874660ec10cc6a8a1538322a40989645" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DBusMessage* server_get_time_cb           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle D-Bus get_time method<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>request message</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL if fails, pointer to response DBusMessage if OK </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01085">server_filter()</a>.</p>

</div>
</div><p>
<a class="anchor" name="605aa788ce9115f424bfb04175e52925"></a><!-- doxytag: member="server.c::server_set_time_format_cb" ref="605aa788ce9115f424bfb04175e52925" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DBusMessage* server_set_time_format_cb           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle D-Bus get_time_fmt method. Sets the time format locally and sends time change indication with libosso. Saves config to /home/user/.clockd.conf.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>request message</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL if fails, pointer to response DBusMessage if OK </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01085">server_filter()</a>.</p>

</div>
</div><p>
<a class="anchor" name="774c29b48c1e29014bc8aa6fa01acf24"></a><!-- doxytag: member="server.c::server_get_tz_cb" ref="774c29b48c1e29014bc8aa6fa01acf24" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DBusMessage* server_get_tz_cb           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle D-Bus get_tz method.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>request message</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL if fails, pointer to response DBusMessage if OK </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01085">server_filter()</a>.</p>

</div>
</div><p>
<a class="anchor" name="8d652764c0adee7678716e6882078d7b"></a><!-- doxytag: member="server.c::server_is_net_time_changed_cb" ref="8d652764c0adee7678716e6882078d7b" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DBusMessage* server_is_net_time_changed_cb           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle D-Bus is_net_time_changed method<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>request message</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL if fails, pointer to response DBusMessage if OK </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01085">server_filter()</a>.</p>

</div>
</div><p>
<a class="anchor" name="a9db2e987c18b79e684ad76ce102ef5e"></a><!-- doxytag: member="server.c::server_set_tz_cb" ref="a9db2e987c18b79e684ad76ce102ef5e" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DBusMessage* server_set_tz_cb           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle D-Bus set_tz method. Sets the time zone and sends time change indication. Saves config to /home/user/.clockd.conf.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>request message</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL if fails, pointer to response DBusMessage if OK </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01085">server_filter()</a>.</p>

</div>
</div><p>
<a class="anchor" name="21e22d59119b41c929c3fa6afcbb3964"></a><!-- doxytag: member="server.c::server_get_autosync_cb" ref="21e22d59119b41c929c3fa6afcbb3964" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DBusMessage* server_get_autosync_cb           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle D-Bus get_autosync method<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>request message</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL if fails, pointer to response DBusMessage if OK </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01085">server_filter()</a>.</p>

</div>
</div><p>
<a class="anchor" name="d73595144a50902e37259d4e5d11d31e"></a><!-- doxytag: member="server.c::server_set_autosync_cb" ref="d73595144a50902e37259d4e5d11d31e" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DBusMessage* server_set_autosync_cb           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle D-Bus set_autosync method. Set autosync on/off and sends time change indication with libosso. Saves config to /home/user/.clockd.conf.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>request message</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL if fails, pointer to response DBusMessage if OK </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01085">server_filter()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b759dff3835294c16d298e030b2337b8"></a><!-- doxytag: member="server.c::server_have_opertime_cb" ref="b759dff3835294c16d298e030b2337b8" args="(DBusMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DBusMessage* server_have_opertime_cb           </td>
          <td>(</td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle D-Bus have_opertime method<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>request message</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL if fails, pointer to response DBusMessage if OK </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01085">server_filter()</a>.</p>

</div>
</div><p>
<a class="anchor" name="7b22ccde141142daa56d1512eb2882cb"></a><!-- doxytag: member="server.c::server_filter" ref="7b22ccde141142daa56d1512eb2882cb" args="(DBusConnection *conn, DBusMessage *msg, void *user_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DBusHandlerResult server_filter           </td>
          <td>(</td>
          <td class="paramtype">DBusConnection *&nbsp;</td>
          <td class="paramname"> <em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DBusMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>user_data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle requests (methods or signals) coming via D-Bus<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>conn</em>&nbsp;</td><td>D-Bus connection </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>D-Bus message </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>user_data</em>&nbsp;</td><td>User data (not used)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>DBusHandlerResult </dd></dl>

<p>Referenced by <a class="el" href="server_8c-source.html#l01245">server_init()</a>, and <a class="el" href="server_8c-source.html#l01430">server_quit()</a>.</p>

</div>
</div><p>
<a class="anchor" name="5bb06385380180590dbab357a0c5872d"></a><!-- doxytag: member="server.c::server_init" ref="5bb06385380180590dbab357a0c5872d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int server_init           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Init D-Bus server<p>
The following is set up:<ul>
<li>settings from environment (/etc/clockd/clockd-settings.default)</li><li>settings from configuration file (/home/user/.clockd.conf)</li><li>D-Bus connections</li><li>libosso init</li><li>timezone from /etc/localtime or /home/user/.clockd.conf</li></ul>
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 if OK, -1 if error </dd></dl>

<p>Referenced by <a class="el" href="mainloop_8c-source.html#l00096">mainloop_run()</a>.</p>

</div>
</div><p>
<a class="anchor" name="e41a4eef04590dbaad21aa4f8eee8169"></a><!-- doxytag: member="server.c::server_quit" ref="e41a4eef04590dbaad21aa4f8eee8169" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void server_quit           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Deinitialize D-Bus server 
<p>Referenced by <a class="el" href="mainloop_8c-source.html#l00096">mainloop_run()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jun 21 15:45:53 2010 for clockd by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
